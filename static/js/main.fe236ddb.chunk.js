(this.webpackJsonptfjs_test=this.webpackJsonptfjs_test||[]).push([[0],{105:function(e,t){},106:function(e,t){},107:function(e,t){},108:function(e,t){},109:function(e,t){},110:function(e,t){},111:function(e,t,a){},112:function(e,t,a){},113:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),r=a(20),l=a.n(r),i=a(7),o=(a(96),a(120)),m=a(118),s=a(119),u=a(116),f=a(121),d=a(115),g=a(123),b=function(e){var t=e.className,a=e.defaultImg,r=e.imgURL,l=e.setImgURL,o=e.onChangeImage,m=e.disableButtons,s=void 0!==m&&m,f=Object(n.useRef)(),b=Object(n.useState)(a),p=Object(i.a)(b,2),E=p[0],h=p[1];return c.a.createElement(d.a,{className:t},c.a.createElement(g.a,{value:E,onChange:function(e){return h(e.target.value)},onClick:function(){return h("")},onBlur:function(){return h(r)},placeholder:"Image url","aria-label":"Image url"}),c.a.createElement(d.a.Append,null,c.a.createElement(u.a,{variant:"outline-secondary",onClick:function(){l(E),o()},disabled:s},"Load image url")),c.a.createElement(d.a.Append,null,c.a.createElement("input",{ref:f,type:"file",style:{display:"none"},accept:"image/*",onChange:function(e){var t=URL.createObjectURL(e.target.files[0]);l(t),h(t),o()}}),c.a.createElement(u.a,{variant:"outline-secondary",onClick:function(){return f.current.click()},disabled:s},"Upload image")))},p=a(66),E=a.n(p),h=a(117),v=Object(n.forwardRef)((function(e,t){var a=e.imgURL,n=e.heatmapURL,r=e.className;return c.a.createElement(c.a.Fragment,null,c.a.createElement(h.a,{crossOrigin:"anonymous",className:r,style:{display:n?"none":"inherit"},ref:t,src:a}),n&&c.a.createElement(E.a,{leftImage:a,leftImageCss:{position:"static"},rightImage:n,className:r}))})),j=a(67),y=a(14),O=a(31),N=parseInt(191.25),C=function(){var e=Object(n.useState)(),t=Object(i.a)(e,2),a=t[0],c=t[1];return Object(n.useEffect)((function(){j.a().then((function(e){c(e),console.log("model loaded")}))}),[]),a},R=a(122),I=function(e){var t=e.predictions,a=e.children;return c.a.createElement(c.a.Fragment,null,t&&c.a.createElement(R.a,{variant:"primary"},c.a.createElement("ol",null,t.map((function(e,t){return c.a.createElement("li",{key:t},e)}))),a))},L=(a(111),function(e){var t=e.heatmapLayers,a=e.onChange,r=Object(n.useMemo)((function(){var e=/.*MobilenetV1\/(.*)\/Relu6/;return t.map((function(t){return e.exec(t)[1]}))}),[t]);if(t)return c.a.createElement(m.a,{className:"justify-content-start"},c.a.createElement(s.a,{className:"col-auto"},c.a.createElement("label",{className:"selection-label mb-0 ml-2"},"Select heatmap layer"),c.a.createElement("select",{className:"custom-select",onChange:function(e){return a(+e.target.value)}},r.map((function(e,t){return c.a.createElement("option",{key:t,value:t},e)})))))}),k=(a(112),"https://cdn.glitch.com/5bf7c54b-c36f-4009-a191-186909fb788e%2Fcat_flickr_publicdomain.jpg"),x=function(){var e=Object(n.useRef)(),t=Object(n.useState)(k),a=Object(i.a)(t,2),r=a[0],l=a[1],d=Object(n.useState)(),g=Object(i.a)(d,2),p=g[0],E=g[1],h=Object(n.useState)(),j=Object(i.a)(h,2),R=j[0],x=j[1],U=Object(n.useState)(0),S=Object(i.a)(U,2),w=S[0],F=S[1],B=C(),P=Object(n.useMemo)((function(){if(B)return function(e){return e.model.artifacts.modelTopology.node.filter((function(e){return e.name.includes("pointwise/Relu6")})).map((function(e){return e.name}))}(B)}),[B]),_=Object(n.useCallback)((function(t){if(P){var a,n=function(e){var t=e.model,a=e.x,n=e.layerName;return y.c((function(){var e=y.a.fromPixels(a),c=e.toFloat().mul(t.normalizationConstant).add(t.inputMin),r=c,l=e.shape;if(224!==e.shape[0]||224!==e.shape[1]){r=y.b.resizeBilinear(c,[224,224],!0)}var i=r.reshape([-1,224,224,3]),o=t.model.execute(i,n).mean([0,-1]);return(o=(o=o.sub(o.min())).div(o.max())).expandDims(-1).resizeBilinear(l.slice(0,2),!0)}))}({model:B,x:e.current,layerName:P[t]});(a=n,new Promise((function(e){var t=document.createElement("canvas");y.a.toPixels(a,t).then((function(){for(var a=t.getContext("2d"),n=a.getImageData(0,0,t.width,t.height),c=n.data,r=0;r<c.length/4;r++){var l=4*r,i=Object(O.a)(Object(O.b)(c[l]/255));c[l]=i.r,c[l+1]=i.g,c[l+2]=i.b,c[l+3]=N}a.putImageData(n,0,0),e(t.toDataURL())}))}))).then(E)}}),[P,B]);return c.a.createElement(o.a,null,c.a.createElement("header",null,c.a.createElement("h1",{className:"mt-4 mb-4"},"tfjs test")),c.a.createElement("main",null,c.a.createElement(b,{className:"mb-3",defaultImg:k,imgURL:r,setImgURL:l,onChangeImage:function(){E(void 0),x(void 0)},disableButtons:!B}),c.a.createElement(m.a,{className:"justify-content-center"},c.a.createElement(s.a,{lg:9},c.a.createElement(v,{className:"w-100 mb-2",imgURL:r,heatmapURL:p,ref:e}),!p&&c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"mb-2 ml-2"},c.a.createElement(u.a,{variant:"outline-secondary",onClick:function(){!function(e){var t=e.model,a=e.img,n=e.setPredictions;t.classify(a).then((function(e){console.log("Predictions:"),console.log(e);var t=e.map((function(e){return"".concat(e.className," (").concat(e.probability.toFixed(2),")")}));n(t)}))}({model:B,img:e.current,setPredictions:x}),_(w)},disabled:!B},B?"Classify this!":c.a.createElement(c.a.Fragment,null,"Loading model..."," ",c.a.createElement(f.a,{animation:"border",size:"sm"}))))),c.a.createElement(I,{predictions:R},c.a.createElement(L,{heatmapLayers:P,onChange:function(e){_(e),F(e)}}))))),c.a.createElement("footer",null,c.a.createElement(m.a,null,c.a.createElement(s.a,{className:"mt-4 text-right"},c.a.createElement("a",{href:"https://github.com/renato145/tfjs_test",target:"_black"},"Source code")))))};l.a.render(c.a.createElement(x,null),document.getElementById("root"))},91:function(e,t,a){e.exports=a(113)}},[[91,1,2]]]);
//# sourceMappingURL=main.fe236ddb.chunk.js.map